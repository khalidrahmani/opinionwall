extends ../layouts/layout 

block content
  #content.container
    p.lead
      h4= survey.question
    p
      | #{formatDate(survey.createdAt, "%b %d, %Y at %I:%M %p")} By : 
      a(href="/users/"+survey.user._id)=survey.user.name  
    .row
      .span4    
        div#donut.graph
      .span8    
        div#graph.graph             
    .btn-group  
      button.btn.btn-small.vote
        i.icon-thumbs-up
        |  Vote
      button.btn.btn-small.share  Share            
      button.btn.btn-small.flag 
        i.icon-flag   
        |  Flag
           
    .popover-inner.votepop(style="display:none")        
      button.close(type="button") ×
      h4.popover-title Vote   
      div.popover-content        
        form#vote_form(method="post", action="/surveys/#{survey._id}/choice")          
          each choice in survey.choices
            if (survey.type == "unique")
              div
                label.radio #{choice._id}
                  input(type="radio", value="#{choice._id}", name="choice", checked="#{userChoice}"==choice._id)   #{choice._id}
            else
              div
                - var val = multiUserChoice != null ? multiUserChoice.id(choice._id).val : "" 
                  select.input-mini(name="#{choice._id}")
                    option(value="0", selected="#{val}"==0) 0
                    option(value="1", selected="#{val}"==1) 1
                    option(value="2", selected="#{val}"==2) 2
                    option(value="3", selected="#{val}"==3) 3
                    option(value="4", selected="#{val}"==4) 4
                    option(value="5", selected="#{val}"==5) 5
                &nbsp;      
                span #{choice._id}                      
          button.btn.btn-info.btn-small(type='submit') Submit      
          
    .popover-inner.sharepop(style="display:none")        
      button.close(type="button") ×
      h4.popover-title Share   
      div.popover-content  
        br
        a.facebook(href='/auth/facebook', onclick="window.open('http://www.facebook.com/sharer.php?u=http%3A%2F%2Fwrapbootstrap.com%2F&amp;t=WrapBootstrap:%20Themes%20for%20Twitter%20Bootstrap','','scrollbars=yes,width=660,height=328'); return false;", href="#" )                                 
        a.twitter(href='/auth/twitter')                
        a.google(href='/auth/google')
        br
        br 
        
    .popover-inner.flagpop(style="display:none")        
      button.close(type="button") ×
      h4.popover-title Flag   
      div.popover-content  
        button.btn.btn-info.btn-small Flag as inappropriate
                
    input(type="hidden", id="survey_id", name="id", value="#{survey._id}")     
    br
    br  
    .row
      .span9     
        div#disqus_thread.box.clearfix

  
block custom_page_script
  script(type='text/javascript', src='/js/raphael-min.js')
  script(type='text/javascript', src='/js/morris.min.js')  
  script    
    var graph = Morris.Line({
      element: 'graph',
      data: !{graph_data},
      xkey: 'period',
      ykeys:  !{xkeys},
      labels: !{xkeys}
    })
    Morris.Donut({
      element: 'donut',
      data: !{donut_data},
      formatter: function (y) { return y + "%" }
    })
    $(".share").click(function(){         
        $(".popover-inner").hide()
        $(".sharepop").fadeIn()
        //var url = "/flag/"+$("#survey_id").val()
        //$.getJSON(url,{},
        //function(data) {
          //alert(data)
        //})
    })
    $(".vote").click(function(){  
        $(".popover-inner").hide()    
        $(".votepop").fadeIn()        
    })
    $(".flag").click(function(){  
        $(".popover-inner").hide()    
        $(".flagpop").fadeIn()        
    })    
    $(".close").click(function(e){    
        e.preventDefault()
        $(this).closest('div').fadeOut()  
        
        //var url = "/flag/"+$("#survey_id").val()
        //$.getJSON(url,{},
        //function(data) {
          //alert(data)
        //})
    })    

    $('#vote_form').submit(function (e) {
        e.preventDefault()
        var url = "/surveys/"+$("#survey_id").val()+"/choice"
        var fields = $("#vote_form").serializeArray()
        $.post(url,{data: fields},
        function(data){
           if(data.html === "Ok") $("#vote_form").append(' Thank you for your Opinion !')
           //  alert(res.html)
           //  graph.setData(d)         
        }, 'json')
    })
    
    // share tweeter
    //!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
    // share google 
    //(function() {var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true; po.src = 'https://apis.google.com/js/plusone.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);})();
    // share fk 
    //(function(d, s, id) {var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return;js = d.createElement(s); js.id = id;js.src = "//connect.facebook.net/fr_FR/all.js#xfbml=1&appId=257956334321936";fjs.parentNode.insertBefore(js, fjs);}(document, 'script', 'facebook-jssdk'));
  script(type='text/javascript', src='/js/survey_show.js')

          