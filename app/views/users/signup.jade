extends ../layouts/layout
block content
  #content.container
    .row
        .span8.offset2
          .box.clearfix
            .page-header
              h1
                a.btn.btn-success.pull-right.trigger-lightbox.validate-register(href='/login') Already registered ?
                | Sign up
            .facebook-login
              p.mbxs Or Sign up via :
              a(href='/auth/facebook')
                img(src="img/facebook.png", alt="facebook")                             
              a(href='/auth/twitter')
                img(src="img/twitter.png", alt="twitter")                              
              a(href='/auth/google')
                img(src="img/gplus.png", alt="google")                
            form#signup.form-vertical.login(action='/users', method='post')
              .control-group.name_cg
                label.control-label.required(for='name') User Name
                .controls
                  input#name(type='text', tabindex='1', value=user.name, name='name')            
              .control-group.email_cg
                label.control-label.required(for='email') Email address
                .controls
                  input#email(type='text', tabindex='1', value=user.email, name='email')
              .control-group.password_cg
                label.control-label.required(for='password')
                  | Password 
                .controls
                  input#password(type='password', tabindex='2', name='password')
              
              button.btn.btn-primary(type='submit') Sign up 
              &nbsp;       
              a.btn(href='/') Cancel

block custom_page_script
    script  
      $("input").focusout(function() {        
        $(".control-group").removeClass("error")
        $(".alert-error").remove()
        $(".help-inline").remove()  
      })

      $('#signup').submit(function (e) {
          e.preventDefault()
          $(".alert-error").remove()  
          $(".help-inline").remove()                
          $("#signup").append('<div class="ajax-loader"></div>')
          $.post("/users",{name: $("#name").val(), email: $("#email").val(), password: $("#password").val()},
                  function(data) { // success
                    if(data.html === "Ok") $(location).attr('href',"/")
                    else{
                      $.each(data.html,function(i,el)
                      {
                        if(el != null){
                           $("."+el.param+"_cg").addClass("error")
                           $("."+el.param+"_cg").find(".controls").append("<span class='help-inline'>"+el.msg+"</span>")
                         }
                      })
                      
                      $(".ajax-loader").remove()
                      $(".navbar").append('<div class="alert alert-error"><button data-dismiss="alert" class="close">Ã—</button>Please Correct Errors.</div>')
                    } 
              }, 'json')
      })





